{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Template to launch an Amazon Linux instance.",
  "Parameters": {
    "InstanceType": {
      "Type": "String",
      "Default": "m1.small",
      "AllowedValues": [ "m1.small", "m1.large", "m1.xlarge" ],
      "Description": "Enter m1.small, m1.large, or m1.xlarge. Default is m1.small."
    },
  },
  "Mappings": {
    "RegionMap" : {
      "us-east-1"      : { "AMI" : "ami-05355a6c" },
      "us-west-1"      : { "AMI" : "ami-3ffed17a" },
      "us-west-2"      : { "AMI" : "ami-0358ce33" },
      "eu-west-1"      : { "AMI" : "ami-c7c0d6b3" },
      "sa-east-1"      : { "AMI" : "ami-5253894f" },
      "ap-southeast-1" : { "AMI" : "ami-fade91a8" },
      "ap-southeast-2" : { "AMI" : "ami-d16bfbeb" },
      "ap-northeast-1" : { "AMI" : "ami-39b23d38" }
    }
  },
  "Resources": {
    "Ec2Instance": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "ImageId":  {"Fn::FindInMap":["RegionMap", {"Ref" : "AWS::Region" }, "AMI" ]},
        "InstanceType": { "Ref": "InstanceType" },
        "SecurityGroups": [ { "Ref": "WebSecurityGroup" } ]
      }
    },
    "WebSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Enable TCP access for Web and SSH traffic from outside",
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": "80",
            "ToPort": "80",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "IpProtocol": "tcp",
            "FromPort": "22",
            "ToPort": "22",
            "CidrIp": "0.0.0.0/0"
          }
        ]
      }
    }
  },
  "Outputs": {
    "InstanceId": {
      "Description": "Instance ID of the Web Server",
      "Value": { "Ref": "Ec2Instance" }
    },
    "AZ": {
      "Description": "Instances is running in Availability Zone ",
      "Value": { "Fn::GetAtt": [ "Ec2Instance", "AvailabilityZone" ] }
    },
    "PublicIP": {
      "Description": "Public IP",
      "Value": { "Fn::GetAtt": [ "Ec2Instance", "PublicIp" ] }
    },
    "PublicDNS": {
      "Description": "Instance Public DNS Name",
      "Value": { "Fn::GetAtt": [ "Ec2Instance", "PublicDnsName" ] }
    }
  }
}

